<template>
  <div id="example-one" class="container mb-3 mt-3">
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
      crossorigin="anonymous"
    />
    <h1>vue-form-json-schema</h1>
    <h3>Example #1 <small class="text-muted">Minimal example</small></h3>
    <p class="lead">
      <span>A minimal example showing a simple <code>input</code> field.</span>
    </p>

    <form @submit="onSubmit" novalidate>
      <vue-form-json-schema
        v-model="model"
        v-model:state="state"
        v-model:validated="valid"
        :schema="schema"
        :ui-schema="uiSchema"
        :options="options"
      >
      </vue-form-json-schema>

      <div class="form-group">
        <button type="submit" class="btn btn-primary">
          Submit form
        </button>
      </div>

      <transition name="fade" mode="out-in">
        <div>
          <div
            v-if="submitted && success"
            class="alert alert-success"
            key="success"
          >
            Form submitted successfully!
          </div>
          <div
            v-if="submitted && !success && state.vfjsErrors.length > 0"
            class="alert alert-danger"
            key="has-errors"
          >
            Form has errors, please fix and resubmit!
          </div>
          <div
            v-if="submitted && !success && state.vfjsErrors.length === 0"
            class="alert alert-success"
            key="has-no-errors"
          >
            Form errors have been corrected. You can now resubmit the form.
          </div>
        </div>
      </transition>
    </form>

    <hr />

    <h4>Model</h4>
    <pretty-print :value="model"></pretty-print>

    <h4>Schema</h4>
    <pretty-print :value="schema"></pretty-print>

    <h4>UI Schema</h4>
    <pretty-print :value="uiSchema"></pretty-print>

    <h4>State</h4>
    <pretty-print :value="state"></pretty-print>

    <h4>Valid</h4>
    <div>{{ valid }}</div>
  </div>
</template>

<script>
import { set } from 'lodash';

const semiAdvancedUiSchema = [
  {
    component: 'div',
    fieldOptions: {
      class: ['form-group'],
    },
    children: [
      {
        component: 'label',
        fieldOptions: {
          props: {
            attrs: {
              for: 'first-name',
            },
            class: ['font-weight-bold'],
            innerHTML: 'First name',
          },
        },
      },
      {
        component: 'input',
        model: 'user.firstName',
        errorOptions: {
          class: ['is-invalid'],
        },
        fieldOptions: {
          attrs: {
            id: 'first-name',
          },
          class: ['form-control'],
          on: ['input'],
        },
      },
      {
        component: 'small',
        fieldOptions: {
          class: ['text-muted'],
          domProps: {
            innerHTML: 'Please enter your first name',
          },
        },
      },
    ],
  },
];

const advancedUiSchema = [
  // Input for firstName
  {
    component: 'div',
    fieldOptions: {
      class: ['form-group'],
    },
    children: [
      {
        component: 'label',
        fieldOptions: {
          for: 'first-name',
          class: ['font-weight-bold', 'test'],
          innerHTML: 'First name',
        },
      },
      {
        component: 'input',
        model: 'user.firstName',
        errorOptions: {
          class: ['is-invalid'],
        },
        fieldOptions: {
          id: 'first-name',
          class: ['form-control'],
          on: ['input'],
        },
      },
      {
        component: 'small',
        fieldOptions: {
          class: ['text-muted'],
          innerHTML: 'Please enter your first name',
        },
      },
    ],
  },
  // Validation messages for firstName
  {
    component: 'transition',
    fieldOptions: {
      name: 'fade',
    },
    children: [
      {
        component: 'div',
        model: 'user.firstName',
        errorHandler: true,
        displayOptions: {
          model: 'user.firstName',
          schema: {
            not: {
              type: 'string',
            },
          },
        },
        fieldOptions: {
          class: ['alert alert-danger'],
        },
        children: [
          {
            component: 'div',
            fieldOptions: {
              innerHTML: 'This field is required',
            },
          },
        ],
      },
    ],
  },
  // Input for lastName
  {
    component: 'div',
    fieldOptions: {
      class: ['form-group'],
    },
    children: [
      {
        component: 'label',
        fieldOptions: {
          for: 'last-name',
          class: ['font-weight-bold'],
          innerHTML: 'Last name',
        },
      },
      {
        component: 'input',
        model: 'user.lastName',
        errorOptions: {
          class: ['is-invalid'],
        },
        fieldOptions: {
          id: 'last-name',
          class: ['form-control'],
          on: ['input'],
        },
      },
      {
        component: 'small',
        fieldOptions: {
          class: ['text-muted'],
          domProps: {
            innerHTML: 'Please enter your last name',
          },
        },
      },
    ],
  },
  // Validation messages for lastName
  {
    component: 'transition',
    fieldOptions: {
      props: {
        name: 'fade',
      },
    },
    children: [
      {
        component: 'div',
        model: 'user.lastName',
        errorHandler: true,
        displayOptions: {
          model: 'user.lastName',
          schema: {
            not: {
              type: 'string',
            },
          },
        },
        fieldOptions: {
          class: ['alert alert-danger'],
        },
        children: [
          {
            component: 'div',
            fieldOptions: {
              domProps: {
                innerHTML: 'This field is required',
              },
            },
          },
        ],
      },
    ],
  },
  // Input for age
  {
    component: 'div',
    fieldOptions: {
      class: ['form-group'],
    },
    children: [
      {
        component: 'label',
        fieldOptions: {
          for: 'age',
          class: ['font-weight-bold'],
          innerHTML: 'Age',
        },
      },
      {
        component: 'input',
        model: 'user.age',
        errorOptions: {
          class: ['is-invalid'],
        },
        fieldOptions: {
          id: 'age',
          type: 'number',
          min: 0,
          class: ['form-control'],
          on: ['input'],
        },
      },
      {
        component: 'small',
        fieldOptions: {
          class: ['text-muted'],
          domProps: {
            innerHTML: 'Please confirm that you are over 18 years of age',
          },
        },
      },
    ],
  },
  // Validation messages for age
  {
    component: 'transition',
    fieldOptions: {
      props: {
        name: 'fade',
        mode: 'out-in',
      },
    },
    children: [
      // Validation message shown when value is empty
      {
        component: 'div',
        model: 'user.age',
        errorHandler: true,
        displayOptions: {
          model: 'user.age',
          schema: {
            not: {
              type: 'number',
            },
          },
        },
        fieldOptions: {
          class: ['alert alert-danger'],
        },
        children: [
          {
            component: 'div',
            fieldOptions: {
              domProps: {
                innerHTML: 'This field is required',
              },
            },
          },
        ],
      },
      // Validation message when value < 18
      {
        component: 'div',
        model: 'user.age',
        errorHandler: true,
        displayOptions: {
          model: 'user.age',
          schema: {
            type: 'number',
            not: {
              minimum: 18,
            },
          },
        },
        fieldOptions: {
          class: ['alert alert-danger'],
        },
        children: [
          {
            component: 'div',
            fieldOptions: {
              domProps: {
                innerHTML: 'You must be 18 or older to submit this form',
              },
            },
          },
        ],
      },
    ],
  },
  {
    component: 'div',
    fieldOptions: {
      class: ['form-group'],
    },
    children: [
      {
        component: 'div',
        fieldOptions: {
          class: ['font-weight-bold'],
          domProps: {
            innerHTML: 'Message (optional)',
          },
        },
      },
      {
        component: 'textarea',
        model: 'user.message',
        fieldOptions: {
          attrs: {
            placeholder: 'Type a message here...',
          },
          class: ['form-control'],
          on: ['input'],
        },
      },
    ],
  },
  // Radio buttons for consent
  {
    component: 'div',
    fieldOptions: {
      class: ['form-group'],
    },
    children: [
      {
        component: 'div',
        fieldOptions: {
          class: ['font-weight-bold'],
          domProps: {
            innerHTML: 'Terms and conditions',
          },
        },
      },
      {
        component: 'div',
        children: [
          {
            component: 'span',
            fieldOptions: {
              domProps: {
                innerHTML:
                  'Please acknowledge that you have read and accept our ',
              },
            },
          },
          {
            component: 'a',
            fieldOptions: {
              attrs: {
                href: '#',
              },
              domProps: {
                innerHTML: 'Terms and conditions',
              },
            },
          },
        ],
      },
      // "Yes" radio button
      {
        component: 'div',
        fieldOptions: {
          class: ['form-check'],
        },
        children: [
          {
            component: 'input',
            model: 'user.consent',
            errorOptions: {
              class: ['is-invalid'],
            },
            fieldOptions: {
              class: ['form-check-input'],
              on: 'change',
              attrs: {
                id: 'consent-yes',
                name: 'name',
                type: 'radio',
              },
              domProps: {
                value: true,
              },
            },
          },
          {
            component: 'label',
            fieldOptions: {
              attrs: {
                for: 'consent-yes',
              },
              class: ['form-check-label'],
              domProps: {
                innerHTML: 'Yes, I agree',
              },
            },
          },
        ],
      },
      // "No" radio button
      {
        component: 'div',
        fieldOptions: {
          class: ['form-check'],
        },
        children: [
          {
            component: 'input',
            model: 'user.consent',
            errorOptions: {
              class: ['is-invalid'],
            },
            fieldOptions: {
              class: ['form-check-input'],
              on: 'change',
              attrs: {
                id: 'consent-no',
                name: 'name',
                type: 'radio',
              },
              domProps: {
                value: false,
              },
            },
          },
          {
            component: 'label',
            fieldOptions: {
              attrs: {
                for: 'consent-no',
              },
              class: ['form-check-label'],
              domProps: {
                innerHTML: 'No, I do not agree',
              },
            },
          },
        ],
      },
    ],
  },
  // Validation messages for consent
  {
    component: 'transition',
    fieldOptions: {
      props: {
        name: 'fade',
        mode: 'out-in',
      },
    },
    children: [
      // Validation message shown when an input has not been selected
      {
        component: 'div',
        model: 'user.consent',
        errorHandler: true,
        displayOptions: {
          model: 'user.consent',
          schema: {
            not: {
              type: 'boolean',
            },
          },
        },
        fieldOptions: {
          class: ['alert alert-danger'],
        },
        children: [
          {
            component: 'div',
            fieldOptions: {
              domProps: {
                innerHTML: 'This field is required',
              },
            },
          },
        ],
      },
      // Validation message shown when the "No" input has been selected
      {
        component: 'div',
        model: 'user.consent',
        errorHandler: true,
        displayOptions: {
          model: 'user.consent',
          schema: {
            const: false,
          },
        },
        fieldOptions: {
          class: ['alert alert-danger'],
        },
        children: [
          {
            component: 'div',
            fieldOptions: {
              domProps: {
                innerHTML:
                  'You must consent to our terms and conditions to submit this form.',
              },
            },
          },
        ],
      },
    ],
  },
];

const simpleUiSchema = [
  {
    component: 'input',
    model: 'firstName',
    fieldOptions: {
      class: ['form-control'],
      on: ['input'],
      attrs: {
        placeholder: 'Please enter your first name',
      },
    },
  },
];

export default {
  name: 'ExampleOne',
  data() {
    return {
      submitted: false,
      success: false,
      model: {},
      state: {},
      options: {
        castToSchemaType: true,
      },
      valid: false,
      schema: {
        type: 'object',
        required: ['firstName', 'liquidity'],
        properties: {
          firstName: {
            type: 'string',
          },
          liquidity: {
            type: 'array',
            items: {
              minItems: 1,
              type: 'object',
              required: ['venue', 'venue_type'],
              properties: {
                venue: {
                  type: 'string',
                },
                venue_type: {
                  type: 'string',
                },
              },
            },
          },
        },
      },
      uiSchema: [],
      // uiSchema: advancedUiSchema,
      // uiSchema: semiAdvancedUiSchema,
      // uiSchema: simpleUiSchema,
    };
  },
  methods: {
    onSubmit(e) {
      e.preventDefault();

      this.submitted = true;
      this.options = {
        ...this.options,
        showValidationErrors: true,
      };
    },
    createUISchema(key) {
      let template = {
        component: 'input',
        model: key,
        fieldOptions: {
          class: ['form-control'],
          on: ['input'],
          attrs: {
            placeholder: key,
          },
        },
      };

      return template;
    },
  },
  created() {
    this.uiSchema.push(this.createUISchema('firstName'));
    this.uiSchema.push(this.createUISchema('liquidity.0.venue'));
    this.uiSchema.push(this.createUISchema('liquidity.0.venue_type'));
  },
};
</script>
