<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iNNitiatives (CDN)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        [v-cloak] { display: none; }
    </style>
</head>
<body class="bg-slate-100">
    <div id="app" v-cloak>
        <!-- Initial loading message, will be replaced by Vue -->
        <p class="text-center text-xl p-8 text-slate-700">Loading Application...</p>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted, provide, inject } = Vue;

        const dataStore = {
            state: ref({ // Make the state itself reactive
                schema: null,
                data: null,
                loading: true,
                error: null
            }),

            async loadData() {
                this.state.value.loading = true;
                this.state.value.error = null;
                try {
                    // Paths are relative to index.html
                    const schemaResponse = await fetch('./public/schema.json');
                    if (!schemaResponse.ok) throw new Error(`Failed to fetch schema: ${schemaResponse.statusText} (status: ${schemaResponse.status})`);
                    this.state.value.schema = await schemaResponse.json();

                    const dataResponse = await fetch('./public/sample-data.json');
                    if (!dataResponse.ok) throw new Error(`Failed to fetch data: ${dataResponse.statusText} (status: ${dataResponse.status})`);
                    this.state.value.data = await dataResponse.json();

                    console.log('Data store loaded successfully.');
                } catch (e) {
                    console.error('Error loading data store:', e);
                    this.state.value.error = e.message || 'Failed to load data.';
                } finally {
                    this.state.value.loading = false;
                }
            },

            // Getters
            getSchema() { return this.state.value.schema; },
            getData() { return this.state.value.data; },
            isLoading() { return this.state.value.loading; },
            getError() { return this.state.value.error; },

            getProgramSchema() { return this.state.value.schema?.definitions?.programConfiguration; },
            getProgramData() { return this.state.value.data?.program; },
            getPersonSchema() { return this.state.value.schema?.definitions?.person; },
            getPeopleData() { return this.state.value.data?.people; },
            getOpportunitySchema() { return this.state.value.schema?.definitions?.opportunity; },
            getOpportunitiesData() { return this.state.value.data?.opportunities; },
            getInitiativeSchema() { return this.state.value.schema?.definitions?.initiative; },
            getInitiativesData() { return this.state.value.data?.initiatives; }
        };

        const formRenderer = {
            renderField(propKey, propSchema, propData, formIdPrefix = '') {
                const fieldId = `${formIdPrefix}${propKey}`;
                let labelHtml = '';
                if (propSchema.title) {
                    labelHtml = `<label for="${fieldId}" class="block text-sm font-medium text-slate-700 mb-1">${propSchema.title}${propSchema.required ? '<span class="text-red-500">*</span>' : ''}</label>`;
                }

                let descriptionHtml = '';
                if (propSchema.description) {
                    descriptionHtml = `<p class="text-xs text-slate-500 mb-1">${propSchema.description}</p>`;
                }

                let inputHtml = '';
                const value = propData !== undefined ? propData : (propSchema.default !== undefined ? propSchema.default : '');

                if (propSchema.type === 'string' && !propSchema.enum && propSchema.format !== 'textarea') {
                     inputHtml = `<input type="text" id="${fieldId}" name="${propKey}" value="${value}" class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm" ${propSchema.description ? `placeholder="${propSchema.description}"` : ''}>`;
                     descriptionHtml = ''; // Placeholder is used instead of separate description paragraph
                } else if (propSchema.type === 'string' && propSchema.format === 'textarea') {
                    inputHtml = `<textarea id="${fieldId}" name="${propKey}" rows="3" class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm" ${propSchema.description && !labelHtml ? `placeholder="${propSchema.description}"` : ''}>${value}</textarea>`;
                     if (labelHtml && propSchema.description) descriptionHtml = `<p class="text-xs text-slate-500 mb-1">${propSchema.description}</p>`; else descriptionHtml = '';
                } else if (propSchema.enum && Array.isArray(propSchema.enum)) {
                    let optionsHtml = '';
                    propSchema.enum.forEach(optionValue => {
                        optionsHtml += `<option value="${optionValue}" ${optionValue === value ? 'selected' : ''}>${optionValue}</option>`;
                    });
                    inputHtml = `<select id="${fieldId}" name="${propKey}" class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm">${optionsHtml}</select>`;
                } else if (propSchema.type === 'boolean') {
                    inputHtml = `<input type="checkbox" id="${fieldId}" name="${propKey}" class="h-4 w-4 text-sky-600 border-slate-300 rounded focus:ring-sky-500" ${value ? 'checked' : ''}>`;
                    // For checkbox, label typically comes after. Description can be under or beside.
                    return `<div class="mb-4"><div class="flex items-center">${inputHtml}<div class="ml-2">${labelHtml}${descriptionHtml}</div></div></div>`;
                } else if (propSchema.type === 'number' || propSchema.type === 'integer') {
                    inputHtml = `<input type="number" id="${fieldId}" name="${propKey}" value="${value}" class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm" ${propSchema.description ? `placeholder="${propSchema.description}"` : ''} ${propSchema.multipleOf ? `step="${propSchema.multipleOf}"` : ''} ${propSchema.minimum !== undefined ? `min="${propSchema.minimum}"` : ''} ${propSchema.maximum !== undefined ? `max="${propSchema.maximum}"` : ''}>`;
                    descriptionHtml = ''; // Placeholder is used
                }
                // Add more types (number, boolean, select etc.) later

                if (!inputHtml) return ''; // Skip if type not handled yet

                return `<div class="mb-4">${labelHtml}${descriptionHtml}${inputHtml}</div>`;
            },

            renderForm(entitySchema, entityData, formIdPrefix = 'form_') {
                if (!entitySchema || !entitySchema.properties) return '<p>Schema not loaded or invalid.</p>';

                let formHtml = '';
                const properties = Object.entries(entitySchema.properties);

                properties.sort(([, propA], [, propB]) => {
                    const orderA = (propA as any)['nn-order'] || Infinity; // Ensure consistent typing and default for sort
                    const orderB = (propB as any)['nn-order'] || Infinity;
                    return orderA - orderB;
                });

                for (const [propKey, propSchemaPair] of properties) {
                    const propSchema = propSchemaPair as any; // Ensure propSchema is treated as having any property
                    const schemaPrimaryKey = entitySchema.$id || entitySchema.title?.toLowerCase().replace(/\s+/g, '_') + 'Id';
                    if (propKey === schemaPrimaryKey || propSchema.readonly) continue;

                    // Add nn-visible-if check HERE
                    if (propSchema['nn-visible-if']) {
                        const condition = propSchema['nn-visible-if'];
                        const controllingFieldKey = condition.field;
                        // Ensure entityData is not null or undefined before trying to access a property on it
                        const controllingValue = entityData ? entityData[controllingFieldKey] : undefined;

                        // Check if the controlling field's value is defined and if it's included in the condition's 'in' array
                        if (controllingValue === undefined || !condition.in || !Array.isArray(condition.in) || !condition.in.includes(controllingValue)) {
                            continue; // Skip rendering this field
                        }
                    }
                    // End nn-visible-if check

                    formHtml += this.renderField(propKey, propSchema, entityData ? entityData[propKey] : undefined, formIdPrefix);
                }
                return formHtml;
            }
        };

        const ProgramConfigurationView = {
            setup() {
                const programSchema = computed(() => dataStore.getProgramSchema());
                const initialProgramData = computed(() => dataStore.getProgramData());

                const formData = ref({});

                watch(initialProgramData, (newData) => {
                    if (newData) {
                        formData.value = JSON.parse(JSON.stringify(newData)); // Deep copy
                    } else {
                        formData.value = {}; // Initialize if no initial data
                    }
                }, { immediate: true, deep: true });

                const formHtml = computed(() => {
                    if (programSchema.value && Object.keys(formData.value).length > 0) { // Check if formData is populated
                        return formRenderer.renderForm(programSchema.value, formData.value, 'prog_');
                    }
                    if (programSchema.value && initialProgramData.value === undefined && !dataStore.isLoading()) {
                        // Case where initialProgramData might be intentionally null or not present in sample-data
                        // and we need an empty form based on schema.
                        // Initialize formData with defaults from schema if not already done by watch
                         if (Object.keys(formData.value).length === 0) {
                           let defaultData = {};
                           for (const [key, prop] of Object.entries(programSchema.value.properties)) {
                               defaultData[key] = prop.default !== undefined ? prop.default : null;
                           }
                           formData.value = defaultData; // Trigger re-render
                           return formRenderer.renderForm(programSchema.value, formData.value, 'prog_');
                         }
                    }
                    return '<p class="text-slate-500">Loading form or data not available...</p>';
                });

                const handleFormInput = (event) => {
                    const target = event.target;
                    if (target && target.name) { // Ensure target and name exist
                        const { name, value, type, checked } = target;
                        formData.value[name] = type === 'checkbox' ? checked : value;
                    }
                };

                const saveProgram = () => {
                    console.log('Saving Program Configuration:', JSON.parse(JSON.stringify(formData.value)));
                    if (dataStore.state.value.data) {
                       dataStore.state.value.data.program = JSON.parse(JSON.stringify(formData.value));
                       alert('Program configuration saved (simulated)! Data in dataStore updated.');
                    } else {
                       alert('Error: dataStore.state.value.data is null. Cannot save.');
                    }
                };

                const cancelEdit = () => {
                    if (initialProgramData.value) {
                        formData.value = JSON.parse(JSON.stringify(initialProgramData.value));
                    } else {
                        // If there was no initial data, perhaps reset to schema defaults
                         if (programSchema.value) {
                            let defaultData = {};
                           for (const [key, prop] of Object.entries(programSchema.value.properties)) {
                               defaultData[key] = prop.default !== undefined ? prop.default : null;
                           }
                           formData.value = defaultData;
                         } else {
                            formData.value = {};
                         }
                    }
                    alert('Changes cancelled.');
                };

                return {
                    formData,
                    formHtml,
                    handleFormInput,
                    saveProgram,
                    cancelEdit,
                    programSchema
                };
            },
            template: `
            <div class="bg-white shadow-md rounded-lg p-6">
                <h2 class="text-2xl font-semibold text-slate-700 mb-6">Program Configuration</h2>
                <div v-if="!programSchema" class="text-center py-10 text-slate-500">Loading schema...</div>
                <form v-else @input.capture="handleFormInput">
                    <div v-html="formHtml"></div>
                    <div class="mt-8 flex justify-end space-x-3">
                        <button @click.prevent="cancelEdit" type="button" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-4 rounded-md text-sm">Cancel</button>
                        <button @click.prevent="saveProgram" type="button" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm">Save Program</button>
                    </div>
                </form>
            </div>
        `
        };

        let appInstance = null; // Will hold the root Vue app instance proxy

        const PeopleListView = {
            setup() {
                const people = computed(() => dataStore.getPeopleData());

                const viewPersonDetails = (personId) => {
                    if (appInstance) appInstance.navigateTo('PersonDetail', { id: personId });
                };

                const editPerson = (personId) => {
                    if (appInstance) appInstance.navigateTo('PersonEdit', { id: personId });
                };

                const goToAddPerson = () => {
                    if (appInstance) appInstance.navigateTo('PersonEdit', { id: 'new' });
                };

                return {
                    people,
                    viewPersonDetails,
                    editPerson,
                    goToAddPerson
                };
            },
            template: `
            <div class="bg-white shadow-md rounded-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-slate-700">People Management</h2>
                    <button @click="goToAddPerson" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm">Add Person</button>
                </div>
                <div v-if="!people || people.length === 0" class="text-center text-slate-500 py-8">
                    No people found.
                </div>
                <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div v-for="person in people" :key="person.personId" class="bg-slate-50 rounded-lg shadow-lg p-4 hover:shadow-xl transition-shadow duration-200">
                        <div class="flex items-center mb-3">
                            <img v-if="person.personImageUrl" :src="person.personImageUrl" :alt="person.personName" class="w-16 h-16 rounded-full mr-4 object-cover border-2 border-slate-200">
                            <div v-else class="w-16 h-16 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 font-semibold text-xl mr-4 border-2 border-slate-200">
                                {{ person.personName ? person.personName.charAt(0).toUpperCase() : '?' }}
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-slate-800">{{ person.personName || 'N/A' }}</h3>
                                <p class="text-sky-600 text-sm">{{ person.personRole || 'N/A' }}</p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-600 mb-4 h-20 overflow-hidden text-ellipsis">
                            {{ person.personDescription ? (person.personDescription.substring(0, 100) + (person.personDescription.length > 100 ? '...' : '')) : 'No description.' }}
                        </p>
                        <div class="flex justify-end space-x-2">
                            <button @click="viewPersonDetails(person.personId)" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-1 px-3 rounded-md text-xs">View</button>
                            <button @click="editPerson(person.personId)" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-1 px-3 rounded-md text-xs">Edit</button>
                        </div>
                    </div>
                </div>
            </div>
        `
        };

        const PersonDetailView = {
            setup() {
                const personId = computed(() => appInstance ? appInstance.currentId : null);
                const personSchema = computed(() => dataStore.getPersonSchema());

                const personData = computed(() => {
                    if (!personId.value || !dataStore.getPeopleData()) return null;
                    return dataStore.getPeopleData().find(p => p.personId === personId.value);
                });

                const sortedAndGroupedProperties = computed(() => {
                    if (!personSchema.value || !personSchema.value.properties || !personData.value) return {};
                    const groups = {};
                    const propsArray = Object.entries(personSchema.value.properties)
                        .sort(([,a], [,b]) => (a['nn-order'] || Infinity) - (b['nn-order'] || Infinity)); // Ensure items without nn-order go last

                    for (const [key, propDef] of propsArray) {
                        if (key === 'personId' || key === 'personImageUrl') continue;

                        const groupName = propDef['nn-group'] || '_ungrouped';
                        if (!groups[groupName]) groups[groupName] = [];
                        // Store the original key along with the property definition
                        groups[groupName].push({ originalKey: key, ...propDef });
                    }
                    return groups;
                });

                const editPerson = () => {
                    if (personId.value && appInstance) appInstance.navigateTo('PersonEdit', { id: personId.value });
                };
                const backToList = () => {
                    if (appInstance) appInstance.navigateTo('PeopleManagement');
                };

                return {
                    personId,
                    personData,
                    personSchema,
                    sortedAndGroupedProperties,
                    editPerson,
                    backToList,
                    dataStore // Expose dataStore to check its loading state in template
                };
            },
            template: `
            <div v-if="!personData && !dataStore.isLoading()" class="bg-white shadow-md rounded-lg p-6 text-center">
                <p class="text-lg text-slate-600 mb-4">Person not found.</p>
                <button @click="backToList" class="text-sky-600 hover:underline">&larr; Back to People List</button>
            </div>
            <div v-else-if="personData" class="bg-white shadow-md rounded-lg p-6">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <button @click="backToList" class="text-sm text-sky-600 hover:underline mb-2">&larr; Back to People List</button>
                        <div class="flex items-center">
                            <img v-if="personData.personImageUrl" :src="personData.personImageUrl" :alt="personData.personName" class="w-24 h-24 rounded-full mr-6 object-cover border-4 border-white shadow-lg">
                             <div v-else class="w-24 h-24 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 font-semibold text-3xl mr-6 border-4 border-white shadow-lg">
                                {{ personData.personName ? personData.personName.charAt(0).toUpperCase() : '?' }}
                            </div>
                            <h2 class="text-3xl font-bold text-slate-800">{{ personData.personName || 'Person Details' }}</h2>
                        </div>
                    </div>
                    <button @click="editPerson" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm self-start">Edit Person</button>
                </div>

                <div v-for="(properties, groupName) in sortedAndGroupedProperties" :key="groupName" class="mb-6">
                    <h3 v-if="groupName !== '_ungrouped'" class="text-xl font-semibold text-slate-700 mb-3 pb-2 border-b border-slate-200">{{ groupName }}</h3>
                    <dl class="space-y-1">
                        <div v-for="prop in properties" :key="prop.originalKey" class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-1 py-2 border-b border-slate-100 last:border-b-0">
                            <dt class="font-medium text-slate-600">{{ prop.title || prop.originalKey }}</dt>
                            <dd class="text-slate-800 md:col-span-2">
                                <template v-if="prop.format === 'uri' && personData[prop.originalKey]">
                                    <a :href="personData[prop.originalKey]" target="_blank" class="text-sky-600 hover:underline break-all">{{ personData[prop.originalKey] }}</a>
                                </template>
                                <template v-else-if="prop.type === 'array' && Array.isArray(personData[prop.originalKey])">
                                    <ul v-if="personData[prop.originalKey].length > 0" class="list-disc list-inside">
                                        <li v-for="(item, index) in personData[prop.originalKey]" :key="index">{{ item }}</li>
                                    </ul>
                                    <span v-else class="text-slate-500 italic">N/A</span>
                                </template>
                                <template v-else-if="personData[prop.originalKey] !== null && personData[prop.originalKey] !== undefined && personData[prop.originalKey] !== ''">
                                    <div v-if="prop.format === 'textarea'" class="whitespace-pre-wrap">{{ personData[prop.originalKey] }}</div>
                                    <span v-else>{{ personData[prop.originalKey] }}</span>
                                </template>
                                <span v-else class="text-slate-500 italic">N/A</span>

                                <div v-if="prop['nn-tag']" class="mt-1">
                                    <span v-for="tag in (Array.isArray(prop['nn-tag']) ? prop['nn-tag'] : [prop['nn-tag']])" :key="tag"
                                          class="inline-block bg-sky-100 text-sky-700 text-xs font-medium mr-2 mb-1 px-2.5 py-0.5 rounded-full">
                                        {{ tag }}
                                    </span>
                                </div>
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>
            <div v-else class="text-center py-10 text-lg text-slate-500">Loading person details...</div>
        `
        };

        const PersonEditView = {
            setup() {
                const routeId = computed(() => appInstance ? appInstance.currentId : null);
                const isCreateMode = computed(() => routeId.value === 'new');

                const personSchema = computed(() => dataStore.getPersonSchema());
                const initialPersonData = computed(() => {
                    if (isCreateMode.value || !routeId.value || !dataStore.getPeopleData()) return null;
                    return dataStore.getPeopleData().find(p => p.personId === routeId.value);
                });

                const formData = ref({});
                const pageTitle = computed(() => isCreateMode.value ? 'Create New Person' : `Edit ${formData.value.personName || 'Person'}`);

                const initializeNewData = (schema) => {
                    const newPerson = {};
                    if (schema && schema.properties) {
                        for (const [key, propDefPair] of Object.entries(schema.properties)) {
                            // Ensure propDefPair is treated as an object with potential 'default' key
                            const propDef = propDefPair as any;
                            if (propDef.default !== undefined) {
                                newPerson[key] = propDef.default;
                            } else {
                                if (propDef.type === 'array') newPerson[key] = [];
                                else if (propDef.type === 'boolean') newPerson[key] = false;
                                else newPerson[key] = '';
                            }
                        }
                    }
                    newPerson['personId'] = null; // Explicitly null for new, will be set on save
                    return newPerson;
                };

                watch([initialPersonData, personSchema, isCreateMode], ([currentData, schema, createMode]) => {
                    if (createMode && schema) {
                        formData.value = initializeNewData(schema);
                    } else if (currentData) {
                        formData.value = JSON.parse(JSON.stringify(currentData));
                    } else if (!createMode && !currentData && schema) { // Edit mode, but data not found yet (e.g. direct nav)
                        formData.value = {}; // Or some loading state for formData
                    } else {
                        formData.value = {};
                    }
                }, { immediate: true, deep: true });


                const formHtml = computed(() => {
                    // Ensure formData is not empty before rendering, especially for create mode
                    if (personSchema.value && (Object.keys(formData.value).length > 0 || isCreateMode.value) ) {
                         // For create mode, pass the initialized (empty or default-filled) formData
                        return formRenderer.renderForm(personSchema.value, formData.value, 'person_');
                    }
                    return '<p class="text-slate-500">Loading form data or schema...</p>';
                });

                const handleFormInput = (event) => {
                    const target = event.target as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;
                    if (target && target.name) {
                        const { name, value } = target;
                        if ((target as HTMLInputElement).type === 'checkbox') {
                             formData.value[name] = (target as HTMLInputElement).checked;
                        } else {
                            formData.value[name] = value;
                        }
                    }
                };

                const savePerson = () => {
                    let isValid = true;
                    if (personSchema.value && personSchema.value.required && Array.isArray(personSchema.value.required)) {
                        for (const reqField of personSchema.value.required) {
                            const fieldSchema = personSchema.value.properties[reqField];
                            const title = fieldSchema?.title || reqField;
                            if (!formData.value[reqField] && !(typeof formData.value[reqField] === 'boolean' && formData.value[reqField] === false)) {
                                isValid = false;
                                alert(`Field '${title}' is required.`);
                                break;
                            }
                        }
                    }
                    if (!isValid) return;

                    const dataToSave = JSON.parse(JSON.stringify(formData.value));
                    let targetId = routeId.value;

                    if (isCreateMode.value) {
                        dataToSave.personId = 'person_' + Date.now().toString(36) + Math.random().toString(36).substring(2);
                        targetId = dataToSave.personId;
                        console.log('Creating new person:', dataToSave);
                        if (dataStore.state.value.data && dataStore.state.value.data.people) {
                            dataStore.state.value.data.people.push(dataToSave);
                        } else if (dataStore.state.value.data) {
                             dataStore.state.value.data.people = [dataToSave];
                        }
                    } else {
                        console.log('Updating person:', dataToSave);
                         if (dataStore.state.value.data && dataStore.state.value.data.people) {
                            const index = dataStore.state.value.data.people.findIndex(p => p.personId === targetId);
                            if (index !== -1) {
                                dataStore.state.value.data.people[index] = dataToSave;
                            } else {
                                console.error("Person not found in store for update");
                                alert("Error: Could not find person to update.");
                                return;
                            }
                        }
                    }
                    alert('Person saved (simulated)!');
                    if (appInstance && targetId) appInstance.navigateTo('PersonDetail', { id: targetId });
                };

                const cancelEdit = () => {
                    if (isCreateMode.value) {
                        if (appInstance) appInstance.navigateTo('PeopleManagement');
                    } else {
                        if (appInstance && routeId.value) appInstance.navigateTo('PersonDetail', { id: routeId.value });
                    }
                };

                const backNavigation = () => {
                    cancelEdit();
                };

                return {
                    formData,
                    formHtml,
                    handleFormInput,
                    savePerson,
                    cancelEdit,
                    pageTitle,
                    isCreateMode,
                    personSchema,
                    backNavigation,
                    dataStore // For template loading check
                };
            },
            template: `
            <div class="bg-white shadow-md rounded-lg p-6">
                 <div class="mb-6">
                    <button @click="backNavigation" class="text-sm text-sky-600 hover:underline">&larr; {{ isCreateMode ? 'Back to People List' : 'Back to Details' }}</button>
                </div>
                <h2 class="text-2xl font-semibold text-slate-700 mb-6">{{ pageTitle }}</h2>
                <div v-if="!personSchema" class="text-center py-10 text-slate-500">Loading schema...</div>
                <div v-else-if="Object.keys(formData).length === 0 && !isCreateMode && !dataStore.isLoading()" class="text-center py-10 text-slate-500">Person data not found or could not be loaded.</div>
                <div v-else-if="Object.keys(formData).length === 0 && isCreateMode && !dataStore.isLoading() && !personSchema" class="text-center py-10 text-slate-500">Initializing form...</div>
                <form v-else @input.capture="handleFormInput">
                    <div v-html="formHtml"></div>
                    <div class="mt-8 flex justify-end space-x-3">
                        <button @click.prevent="cancelEdit" type="button" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-4 rounded-md text-sm">Cancel</button>
                        <button @click.prevent="savePerson" type="button" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm">Save Person</button>
                    </div>
                </form>
            </div>
        `
        };

        const OpportunitiesListView = {
            setup() {
                const opportunities = computed(() => dataStore.getOpportunitiesData());

                const viewOpportunityDetails = (oppId) => {
                    if (appInstance) appInstance.navigateTo('OpportunityDetail', { id: oppId });
                };
                const editOpportunity = (oppId) => {
                    if (appInstance) appInstance.navigateTo('OpportunityEdit', { id: oppId });
                };
                const goToAddOpportunity = () => {
                    if (appInstance) appInstance.navigateTo('OpportunityEdit', { id: 'new' });
                };

                const getStatusClass = (status) => {
                    const S = String(status).toLowerCase();
                    if (S === 'identified') return 'bg-sky-100 text-sky-700 border border-sky-200';
                    if (S === 'under review') return 'bg-amber-100 text-amber-700 border border-amber-200';
                    if (S === 'prioritized') return 'bg-emerald-100 text-emerald-700 border border-emerald-200';
                    if (S === 'archived') return 'bg-slate-100 text-slate-700 border border-slate-200';
                    return 'bg-slate-200 text-slate-800 border border-slate-300';
                };
                const getPriorityClass = (priority) => {
                    const P = Number(priority);
                    if (P >= 8) return 'bg-rose-100 text-rose-700 border border-rose-200';
                    if (P >= 5) return 'bg-amber-100 text-amber-700 border border-amber-200';
                    if (P >= 0) return 'bg-lime-100 text-lime-700 border border-lime-200';
                    return 'bg-slate-200 text-slate-800 border border-slate-300';
                };

                return {
                    opportunities,
                    viewOpportunityDetails,
                    editOpportunity,
                    goToAddOpportunity,
                    getStatusClass,
                    getPriorityClass
                };
            },
            template: `
            <div class="bg-white shadow-md rounded-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-slate-700">Opportunities Discovery</h2>
                    <button @click="goToAddOpportunity" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm">Add Opportunity</button>
                </div>
                <div v-if="!opportunities || opportunities.length === 0" class="text-center text-slate-500 py-8">
                    No opportunities found.
                </div>
                <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div v-for="opp in opportunities" :key="opp.opportunityId" class="bg-slate-50 rounded-lg shadow-lg p-4 hover:shadow-xl transition-shadow duration-200 flex flex-col justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-slate-800 mb-1">{{ opp.opportunityName || 'N/A' }}</h3>
                            <div class="mb-2 space-x-2 flex flex-wrap gap-y-1">
                                <span v-if="opp.opportunityStatus" :class="getStatusClass(opp.opportunityStatus)" class="px-2 py-0.5 text-xs font-medium rounded-full">{{ opp.opportunityStatus }}</span>
                                <span v-if="opp.opportunityPriority !== undefined && opp.opportunityPriority !== null" :class="getPriorityClass(opp.opportunityPriority)" class="px-2 py-0.5 text-xs font-medium rounded-full">Prio: {{ opp.opportunityPriority }}</span>
                            </div>
                            <p class="text-sm text-slate-600 mb-3 h-20 overflow-hidden text-ellipsis">
                                {{ opp.opportunityDescription ? (opp.opportunityDescription.substring(0, 100) + (opp.opportunityDescription.length > 100 ? '...' : '')) : 'No description.' }}
                            </p>
                        </div>
                        <div class="flex justify-end space-x-2 mt-auto">
                            <button @click="viewOpportunityDetails(opp.opportunityId)" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-1 px-3 rounded-md text-xs">View</button>
                            <button @click="editOpportunity(opp.opportunityId)" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-1 px-3 rounded-md text-xs">Edit</button>
                        </div>
                    </div>
                </div>
            </div>
        `
        };

        const OpportunityDetailView = {
            setup() {
                const opportunityId = computed(() => appInstance ? appInstance.currentId : null);
                const opportunitySchema = computed(() => dataStore.getOpportunitySchema());

                const opportunityData = computed(() => {
                    if (!opportunityId.value || !dataStore.getOpportunitiesData()) return null;
                    return dataStore.getOpportunitiesData().find(o => o.opportunityId === opportunityId.value);
                });

                const sortedAndGroupedProperties = computed(() => {
                    if (!opportunitySchema.value || !opportunitySchema.value.properties || !opportunityData.value) return {};
                    const groups = {};
                    const propsArray = Object.entries(opportunitySchema.value.properties)
                        .sort(([,a], [,b]) => (a['nn-order'] || Infinity) - (b['nn-order'] || Infinity));

                    for (const [key, propDefPair] of propsArray) {
                        const propDef = propDefPair as any;
                        if (['opportunityId', 'opportunityStatus', 'opportunityPriority'].includes(key)) continue;

                        const groupName = propDef['nn-group'] || '_ungrouped';
                        if (!groups[groupName]) groups[groupName] = [];
                        groups[groupName].push({ originalKey: key, ...propDef });
                    }
                    return groups;
                });

                const getStatusClass = (status) => {
                    const S = String(status).toLowerCase();
                    if (S === 'identified') return 'bg-sky-100 text-sky-700 border border-sky-200';
                    if (S === 'under review') return 'bg-amber-100 text-amber-700 border border-amber-200';
                    if (S === 'prioritized') return 'bg-emerald-100 text-emerald-700 border border-emerald-200';
                    if (S === 'archived') return 'bg-slate-100 text-slate-700 border border-slate-200';
                    return 'bg-slate-200 text-slate-800 border border-slate-300';
                };
                const getPriorityClass = (priority) => {
                    const P = Number(priority);
                    if (P >= 8) return 'bg-rose-100 text-rose-700 border border-rose-200';
                    if (P >= 5) return 'bg-amber-100 text-amber-700 border border-amber-200';
                    if (P >= 0) return 'bg-lime-100 text-lime-700 border border-lime-200';
                    return 'bg-slate-200 text-slate-800 border border-slate-300';
                };
                 const getPriorityText = (priority) => {
                    const P = Number(priority);
                    if (P >= 8) return 'High';
                    if (P >= 5) return 'Medium';
                    if (P >= 0) return 'Low';
                    return 'N/A';
                };
                const formatDate = (dateString) => {
                    if (!dateString) return 'N/A';
                    const date = new Date(dateString);
                    if (isNaN(date.getTime())) return dateString;
                    return date.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
                };


                const editOpportunity = () => {
                    if (opportunityId.value && appInstance) appInstance.navigateTo('OpportunityEdit', { id: opportunityId.value });
                };
                const backToList = () => {
                    if (appInstance) appInstance.navigateTo('OpportunitiesDiscovery');
                };

                return {
                    opportunityId,
                    opportunityData,
                    opportunitySchema,
                    sortedAndGroupedProperties,
                    editOpportunity,
                    backToList,
                    getStatusClass,
                    getPriorityClass,
                    getPriorityText,
                    formatDate,
                    dataStore
                };
            },
            template: `
            <div v-if="!opportunityData && !dataStore.isLoading()" class="bg-white shadow-md rounded-lg p-6 text-center">
                <p class="text-lg text-slate-600 mb-4">Opportunity not found.</p>
                <button @click="backToList" class="text-sky-600 hover:underline">&larr; Back to Opportunities List</button>
            </div>
            <div v-else-if="opportunityData" class="bg-white shadow-md rounded-lg p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <button @click="backToList" class="text-sm text-sky-600 hover:underline mb-2">&larr; Back to Opportunities List</button>
                        <h2 class="text-3xl font-bold text-slate-800">{{ opportunityData.opportunityName || 'Opportunity Details' }}</h2>
                    </div>
                    <button @click="editOpportunity" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm self-start">Edit Opportunity</button>
                </div>

                <div class="mb-6 flex flex-wrap gap-x-4 gap-y-2 items-center border-b border-slate-200 pb-4">
                    <span v-if="opportunityData.opportunityStatus" :class="getStatusClass(opportunityData.opportunityStatus)" class="px-3 py-1 text-sm font-semibold rounded-full">Status: {{ opportunityData.opportunityStatus }}</span>
                    <span v-if="opportunityData.opportunityPriority !== undefined && opportunityData.opportunityPriority !== null" :class="getPriorityClass(opportunityData.opportunityPriority)" class="px-3 py-1 text-sm font-semibold rounded-full">Priority: {{ getPriorityText(opportunityData.opportunityPriority) }} ({{opportunityData.opportunityPriority}})</span>
                </div>

                <div v-for="(properties, groupName) in sortedAndGroupedProperties" :key="groupName" class="mb-6">
                    <h3 v-if="groupName !== '_ungrouped'" class="text-xl font-semibold text-slate-700 mb-3 pb-2 border-b border-slate-200">{{ groupName }}</h3>
                    <dl class="space-y-1">
                        <div v-for="prop in properties" :key="prop.originalKey" class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-1 py-2 border-b border-slate-100 last:border-b-0">
                            <dt class="font-medium text-slate-600">{{ prop.title || prop.originalKey }}</dt>
                            <dd class="text-slate-800 md:col-span-2">
                                <template v-if="prop.format === 'uri' && opportunityData[prop.originalKey]">
                                    <a :href="opportunityData[prop.originalKey]" target="_blank" class="text-sky-600 hover:underline break-all">{{ opportunityData[prop.originalKey] }}</a>
                                </template>
                                <template v-else-if="prop.type === 'array' && Array.isArray(opportunityData[prop.originalKey])">
                                    <ul v-if="opportunityData[prop.originalKey].length > 0" class="list-disc list-inside">
                                        <li v-for="(item, index) in opportunityData[prop.originalKey]" :key="index">{{ item }}</li>
                                    </ul>
                                    <span v-else class="text-slate-500 italic">N/A</span>
                                </template>
                                <template v-else-if="prop.format === 'date' || prop.format === 'date-time'">
                                    {{ formatDate(opportunityData[prop.originalKey]) }}
                                </template>
                                <template v-else-if="opportunityData[prop.originalKey] !== null && opportunityData[prop.originalKey] !== undefined && opportunityData[prop.originalKey] !== ''">
                                    <div v-if="prop.format === 'textarea'" class="whitespace-pre-wrap">{{ opportunityData[prop.originalKey] }}</div>
                                    <span v-else>{{ opportunityData[prop.originalKey] }}</span>
                                </template>
                                <span v-else class="text-slate-500 italic">N/A</span>

                                <div v-if="prop['nn-tag']" class="mt-1">
                                    <span v-for="tag in (Array.isArray(prop['nn-tag']) ? prop['nn-tag'] : [prop['nn-tag']])" :key="tag"
                                          class="inline-block bg-sky-100 text-sky-700 text-xs font-medium mr-2 mb-1 px-2.5 py-0.5 rounded-full">
                                        {{ tag }}
                                    </span>
                                </div>
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>
            <div v-else class="text-center py-10 text-lg text-slate-500">Loading opportunity details...</div>
        `
        };

        const OpportunityEditView = {
            setup() {
                const routeId = computed(() => appInstance ? appInstance.currentId : null);
                const isCreateMode = computed(() => routeId.value === 'new');

                const opportunitySchema = computed(() => dataStore.getOpportunitySchema());
                const programConfig = computed(() => dataStore.getProgramData());

                const initialOpportunityData = computed(() => {
                    if (isCreateMode.value || !routeId.value || !dataStore.getOpportunitiesData()) return null;
                    return dataStore.getOpportunitiesData().find(o => o.opportunityId === routeId.value);
                });

                const formData = ref({});
                const pageTitle = computed(() => isCreateMode.value ? 'Create New Opportunity' : `Edit ${formData.value.opportunityName || 'Opportunity'}`);

                const initializeNewData = (schema, progConfig) => {
                    const newOpp = {};
                    if (schema && schema.properties) {
                        for (const [key, propDefPair] of Object.entries(schema.properties)) {
                            const propDef = propDefPair as any;
                            if (propDef.default !== undefined) {
                                newOpp[key] = propDef.default;
                            } else {
                                if (propDef.type === 'array') newOpp[key] = [];
                                else if (propDef.type === 'boolean') newOpp[key] = false;
                                // For strings and other types, initialize as empty or null
                                else newOpp[key] = '';
                            }
                        }
                    }
                    newOpp['opportunityId'] = null;

                    if (progConfig && progConfig.programDefaultOpportunityStatuses && progConfig.programDefaultOpportunityStatuses.length > 0) {
                        newOpp['opportunityStatus'] = progConfig.programDefaultOpportunityStatuses[0];
                    } else {
                        newOpp['opportunityStatus'] = schema?.properties?.opportunityStatus?.default || 'Identified';
                    }
                    newOpp['opportunityDateIdentified'] = new Date().toISOString().split('T')[0];
                    newOpp['opportunityLastUpdated'] = new Date().toISOString();
                    return newOpp;
                };

                watch([initialOpportunityData, opportunitySchema, programConfig, isCreateMode],
                      ([currentData, schema, progConf, createMode]) => {
                    if (createMode && schema && progConf) {
                        formData.value = initializeNewData(schema, progConf);
                    } else if (currentData) {
                        formData.value = JSON.parse(JSON.stringify(currentData));
                    } else if (!createMode && !currentData && schema && progConf) {
                        formData.value = {};
                    } else {
                        formData.value = {};
                    }
                }, { immediate: true, deep: true }); // deep: true for initialOpportunityData if it's complex

                const formHtml = computed(() => {
                    let schemaForForm = opportunitySchema.value;
                    if (schemaForForm && schemaForForm.properties) {
                        const tempSchema = JSON.parse(JSON.stringify(schemaForForm)); // Deep copy
                        delete tempSchema.properties.opportunityId;
                        delete tempSchema.properties.opportunityLastUpdated;
                        schemaForForm = tempSchema;
                    }

                    if (schemaForForm && (Object.keys(formData.value).length > 0 || isCreateMode.value)) {
                        return formRenderer.renderForm(schemaForForm, formData.value, 'opp_');
                    }
                    return '<p class="text-slate-500">Loading form data or schema...</p>';
                });

                const handleFormInput = (event) => {
                    const target = event.target as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;
                    if (target && target.name) {
                        const { name, value } = target;
                         if ((target as HTMLInputElement).type === 'checkbox') {
                             formData.value[name] = (target as HTMLInputElement).checked;
                        } else {
                            formData.value[name] = value;
                        }
                    }
                };

                const saveOpportunity = () => {
                    let isValid = true;
                    if (opportunitySchema.value && opportunitySchema.value.required && Array.isArray(opportunitySchema.value.required)) {
                        for (const reqField of opportunitySchema.value.required) {
                             if (reqField === 'opportunityId' || reqField === 'opportunityLastUpdated') continue;
                            const fieldSchema = opportunitySchema.value.properties[reqField];
                            const title = fieldSchema?.title || reqField;
                            if (!formData.value[reqField] && !(typeof formData.value[reqField] === 'boolean' && formData.value[reqField] === false)) {
                                isValid = false;
                                alert(`Field '${title}' is required.`);
                                break;
                            }
                        }
                    }
                    if (!isValid) return;

                    const dataToSave = JSON.parse(JSON.stringify(formData.value));
                    let targetId = routeId.value;
                    dataToSave.opportunityLastUpdated = new Date().toISOString();

                    if (isCreateMode.value) {
                        dataToSave.opportunityId = 'opp_' + Date.now().toString(36) + Math.random().toString(36).substring(2);
                        targetId = dataToSave.opportunityId;
                        if (!dataToSave.opportunityDateIdentified) {
                            dataToSave.opportunityDateIdentified = new Date().toISOString().split('T')[0];
                        }
                        console.log('Creating new opportunity:', dataToSave);
                        if (dataStore.state.value.data && dataStore.state.value.data.opportunities) {
                            dataStore.state.value.data.opportunities.push(dataToSave);
                        } else if (dataStore.state.value.data) {
                             dataStore.state.value.data.opportunities = [dataToSave];
                        }
                    } else {
                        console.log('Updating opportunity:', dataToSave);
                         if (dataStore.state.value.data && dataStore.state.value.data.opportunities) {
                            const index = dataStore.state.value.data.opportunities.findIndex(o => o.opportunityId === targetId);
                            if (index !== -1) {
                                dataStore.state.value.data.opportunities[index] = dataToSave;
                            } else {
                                 console.error("Opportunity not found in store for update");
                                 alert("Error: Could not find opportunity to update.");
                                 return;
                            }
                        }
                    }
                    alert('Opportunity saved (simulated)!');
                    if (appInstance && targetId) appInstance.navigateTo('OpportunityDetail', { id: targetId });
                };

                const cancelEdit = () => {
                    if (isCreateMode.value) {
                        if (appInstance) appInstance.navigateTo('OpportunitiesDiscovery');
                    } else {
                        if (appInstance && routeId.value) appInstance.navigateTo('OpportunityDetail', { id: routeId.value });
                    }
                };
                const backNavigation = () => cancelEdit();

                return {
                    formData, formHtml, handleFormInput, saveOpportunity, cancelEdit, pageTitle,
                    isCreateMode, opportunitySchema, programConfig,
                    backNavigation, dataStore // For template loading checks
                };
            },
            template: `
            <div class="bg-white shadow-md rounded-lg p-6">
                <div class="mb-6">
                    <button @click="backNavigation" class="text-sm text-sky-600 hover:underline">&larr; {{ isCreateMode ? 'Back to Opportunities List' : 'Back to Details' }}</button>
                </div>
                <h2 class="text-2xl font-semibold text-slate-700 mb-6">{{ pageTitle }}</h2>
                <div v-if="!opportunitySchema || (isCreateMode && !programConfig)" class="text-center py-10 text-slate-500">Loading schema or program configuration...</div>
                <div v-else-if="Object.keys(formData).length === 0 && !isCreateMode && !dataStore.isLoading()" class="text-center py-10 text-slate-500">Opportunity data not found or could not be loaded.</div>
                <div v-else-if="Object.keys(formData).length === 0 && isCreateMode && !dataStore.isLoading() && (!opportunitySchema || !programConfig)" class="text-center py-10 text-slate-500">Initializing form...</div>
                <form v-else @input.capture="handleFormInput">
                    <div v-html="formHtml"></div>
                    <div class="mt-8 flex justify-end space-x-3">
                        <button @click.prevent="cancelEdit" type="button" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-4 rounded-md text-sm">Cancel</button>
                        <button @click.prevent="saveOpportunity" type="button" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm">Save Opportunity</button>
                    </div>
                </form>
            </div>
        `
        };

        const InitiativesListView = {
            setup() {
                const initiatives = computed(() => dataStore.getInitiativesData());

                const viewInitiativeDetails = (id) => {
                    if (appInstance) appInstance.navigateTo('InitiativeDetail', { id });
                };
                const editInitiative = (id) => {
                    if (appInstance) appInstance.navigateTo('InitiativeEdit', { id });
                };
                const goToAddInitiative = () => {
                    if (appInstance) appInstance.navigateTo('InitiativeEdit', { id: 'new' });
                };

                const getTypeClass = (type) => {
                    const typeLower = String(type).toLowerCase();
                    const colors = [
                        'bg-sky-100 text-sky-700 border border-sky-200', 'bg-emerald-100 text-emerald-700 border border-emerald-200',
                        'bg-violet-100 text-violet-700 border border-violet-200', 'bg-amber-100 text-amber-700 border border-amber-200',
                        'bg-indigo-100 text-indigo-700 border border-indigo-200', 'bg-pink-100 text-pink-700 border border-pink-200',
                        'bg-lime-100 text-lime-700 border border-lime-200'
                    ];
                    let hash = 0;
                    for (let i = 0; i < typeLower.length; i++) {
                        hash = typeLower.charCodeAt(i) + ((hash << 5) - hash);
                    }
                    return colors[Math.abs(hash) % colors.length] || 'bg-slate-200 text-slate-800 border border-slate-300';
                };
                const getPhaseClass = (phase) => {
                    const phaseLower = String(phase).toLowerCase();
                    if (phaseLower.includes('idea')) return 'bg-slate-100 text-slate-700 border border-slate-200';
                    if (phaseLower.includes('concept')) return 'bg-sky-100 text-sky-700 border border-sky-200';
                    if (phaseLower.includes('prototype')) return 'bg-indigo-100 text-indigo-700 border border-indigo-200';
                    if (phaseLower.includes('validation')) return 'bg-yellow-100 text-yellow-700 border border-yellow-200';
                    if (phaseLower.includes('pilot')) return 'bg-amber-100 text-amber-700 border border-amber-200';
                    if (phaseLower.includes('launch')) return 'bg-green-100 text-green-700 border border-green-200';
                    if (phaseLower.includes('scaling')) return 'bg-emerald-100 text-emerald-700 border border-emerald-200';
                    if (phaseLower.includes('hold')) return 'bg-orange-100 text-orange-700 border border-orange-200';
                    if (phaseLower.includes('cancel')) return 'bg-rose-100 text-rose-700 border border-rose-200';
                    return 'bg-slate-200 text-slate-800 border border-slate-300';
                };

                return {
                    initiatives,
                    viewInitiativeDetails,
                    editInitiative,
                    goToAddInitiative,
                    getTypeClass,
                    getPhaseClass
                };
            },
            template: `
            <div class="bg-white shadow-md rounded-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-slate-700">Initiative Lifecycle Management</h2>
                    <button @click="goToAddInitiative" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm">Add Initiative</button>
                </div>
                <div v-if="!initiatives || initiatives.length === 0" class="text-center text-slate-500 py-8">
                    No initiatives found.
                </div>
                <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div v-for="init in initiatives" :key="init.initiativeId" class="bg-slate-50 rounded-lg shadow-lg p-4 hover:shadow-xl transition-shadow duration-200 flex flex-col justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-slate-800 mb-1">{{ init.initiativeName || 'N/A' }}</h3>
                            <div class="mb-2 space-x-2 flex flex-wrap gap-y-1">
                                <span v-if="init.initiativeType" :class="getTypeClass(init.initiativeType)" class="px-2 py-0.5 text-xs font-medium rounded-full">{{ init.initiativeType }}</span>
                                <span v-if="init.initiativePhase" :class="getPhaseClass(init.initiativePhase)" class="px-2 py-0.5 text-xs font-medium rounded-full">{{ init.initiativePhase }}</span>
                            </div>
                            <!-- No description field in initiative schema for list view based on current data model -->
                        </div>
                        <div class="flex justify-end space-x-2 mt-auto pt-3">
                            <button @click="viewInitiativeDetails(init.initiativeId)" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-1 px-3 rounded-md text-xs">View</button>
                            <button @click="editInitiative(init.initiativeId)" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-1 px-3 rounded-md text-xs">Edit</button>
                        </div>
                    </div>
                </div>
            </div>
        `
        };

        const InitiativeDetailView = {
            setup() {
                const initiativeId = computed(() => appInstance ? appInstance.currentId : null);
                const initiativeSchema = computed(() => dataStore.getInitiativeSchema());

                const initiativeData = computed(() => {
                    if (!initiativeId.value || !dataStore.getInitiativesData()) return null;
                    return dataStore.getInitiativesData().find(i => i.initiativeId === initiativeId.value);
                });

                const sortedAndGroupedProperties = computed(() => {
                    if (!initiativeSchema.value || !initiativeSchema.value.properties || !initiativeData.value) return {};
                    const groups = {};
                    const propsArray = Object.entries(initiativeSchema.value.properties)
                        .sort(([,a], [,b]) => (a['nn-order'] || Infinity) - (b['nn-order'] || Infinity));

                    const specialFields = ['initiativeId', 'initiativeName', 'initiativeType', 'initiativePhase', 'initiativeBudget'];
                    for (const [key, propDefPair] of propsArray) {
                        const propDef = propDefPair as any;
                        if (specialFields.includes(key)) continue;

                        const groupName = propDef['nn-group'] || '_ungrouped';
                        if (!groups[groupName]) groups[groupName] = [];
                        groups[groupName].push({ originalKey: key, ...propDef });
                    }
                    return groups;
                });

                const getTypeClass = (type) => {
                    const typeLower = String(type).toLowerCase();
                    const colors = [
                        'bg-sky-100 text-sky-700 border border-sky-200', 'bg-emerald-100 text-emerald-700 border border-emerald-200',
                        'bg-violet-100 text-violet-700 border border-violet-200', 'bg-amber-100 text-amber-700 border border-amber-200',
                        'bg-indigo-100 text-indigo-700 border border-indigo-200', 'bg-pink-100 text-pink-700 border border-pink-200',
                        'bg-lime-100 text-lime-700 border border-lime-200'
                    ];
                    let hash = 0;
                    for (let i = 0; i < typeLower.length; i++) { hash = typeLower.charCodeAt(i) + ((hash << 5) - hash); }
                    return colors[Math.abs(hash) % colors.length] || 'bg-slate-200 text-slate-800 border border-slate-300';
                };
                const getPhaseClass = (phase) => {
                    const phaseLower = String(phase).toLowerCase();
                    if (phaseLower.includes('idea')) return 'bg-slate-100 text-slate-700 border border-slate-200';
                    if (phaseLower.includes('concept')) return 'bg-sky-100 text-sky-700 border border-sky-200';
                    if (phaseLower.includes('prototype')) return 'bg-indigo-100 text-indigo-700 border border-indigo-200';
                    if (phaseLower.includes('validation')) return 'bg-yellow-100 text-yellow-700 border border-yellow-200';
                    if (phaseLower.includes('pilot')) return 'bg-amber-100 text-amber-700 border border-amber-200';
                    if (phaseLower.includes('launch')) return 'bg-green-100 text-green-700 border border-green-200';
                    if (phaseLower.includes('scaling')) return 'bg-emerald-100 text-emerald-700 border border-emerald-200';
                    if (phaseLower.includes('hold')) return 'bg-orange-100 text-orange-700 border border-orange-200';
                    if (phaseLower.includes('cancel')) return 'bg-rose-100 text-rose-700 border border-rose-200';
                    return 'bg-slate-200 text-slate-800 border border-slate-300';
                };
                const formatCurrency = (value) => {
                    if (value === null || value === undefined) return 'N/A';
                     const numValue = Number(value);
                    if (isNaN(numValue)) return 'N/A'; // Handle if value is not a number
                    return `${numValue.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                };
                const formatDateTime = (dateString, formatType) => { // formatType can be 'date' or 'date-time' from schema
                     if (!dateString) return 'N/A';
                    const date = new Date(dateString);
                    if (isNaN(date.getTime())) return dateString;

                    const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric' };
                    if (formatType === 'date-time' && !(date.getHours() === 0 && date.getMinutes() === 0 && date.getSeconds() === 0)) {
                        options.hour = '2-digit';
                        options.minute = '2-digit';
                    }
                    return date.toLocaleString(undefined, options);
                };

                const editInitiative = () => {
                    if (initiativeId.value && appInstance) appInstance.navigateTo('InitiativeEdit', { id: initiativeId.value });
                };
                const backToList = () => {
                    if (appInstance) appInstance.navigateTo('InitiativeLifecycle');
                };

                return {
                    initiativeId, initiativeData, initiativeSchema, sortedAndGroupedProperties,
                    editInitiative, backToList,
                    getTypeClass, getPhaseClass, formatCurrency, formatDateTime,
                    dataStore
                };
            },
            template: `
            <div v-if="!initiativeData && !dataStore.isLoading()" class="bg-white shadow-md rounded-lg p-6 text-center">
                <p class="text-lg text-slate-600 mb-4">Initiative not found.</p>
                <button @click="backToList" class="text-sky-600 hover:underline">&larr; Back to Initiatives List</button>
            </div>
            <div v-else-if="initiativeData" class="bg-white shadow-md rounded-lg p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <button @click="backToList" class="text-sm text-sky-600 hover:underline mb-2">&larr; Back to Initiatives List</button>
                        <h2 class="text-3xl font-bold text-slate-800">{{ initiativeData.initiativeName || 'Initiative Details' }}</h2>
                    </div>
                    <button @click="editInitiative" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm self-start">Edit Initiative</button>
                </div>

                <div class="mb-6 flex flex-wrap gap-x-4 gap-y-2 items-center border-b border-slate-200 pb-4">
                    <span v-if="initiativeData.initiativeType" :class="getTypeClass(initiativeData.initiativeType)" class="px-3 py-1 text-sm font-semibold rounded-full">{{ initiativeData.initiativeType }}</span>
                    <span v-if="initiativeData.initiativePhase" :class="getPhaseClass(initiativeData.initiativePhase)" class="px-3 py-1 text-sm font-semibold rounded-full">{{ initiativeData.initiativePhase }}</span>
                    <span v-if="initiativeData.initiativeBudget !== undefined && initiativeData.initiativeBudget !== null"
                          class="px-3 py-1 text-sm font-semibold rounded-full bg-lime-100 text-lime-700 border border-lime-200">
                          Budget: {{ formatCurrency(initiativeData.initiativeBudget) }}
                    </span>
                </div>

                <div v-for="(properties, groupName) in sortedAndGroupedProperties" :key="groupName" class="mb-6">
                    <h3 v-if="groupName !== '_ungrouped'" class="text-xl font-semibold text-slate-700 mb-3 pb-2 border-b border-slate-200">{{ groupName }}</h3>
                    <dl class="space-y-1">
                        <div v-for="prop in properties" :key="prop.originalKey" class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-1 py-2 border-b border-slate-100 last:border-b-0">
                            <dt class="font-medium text-slate-600">{{ prop.title || prop.originalKey }}</dt>
                            <dd class="text-slate-800 md:col-span-2">
                                <template v-if="prop.format === 'uri' && initiativeData[prop.originalKey]">
                                    <a :href="initiativeData[prop.originalKey]" target="_blank" class="text-sky-600 hover:underline break-all">{{ initiativeData[prop.originalKey] }}</a>
                                </template>
                                <template v-else-if="prop.type === 'array' && Array.isArray(initiativeData[prop.originalKey])">
                                    <ul v-if="initiativeData[prop.originalKey].length > 0" class="list-disc list-inside">
                                        <li v-for="(item, index) in initiativeData[prop.originalKey]" :key="index">{{ item }}</li>
                                    </ul> <span v-else class="text-slate-500 italic">N/A</span>
                                </template>
                                 <template v-else-if="prop.format === 'date' || prop.format === 'date-time'">
                                    {{ formatDateTime(initiativeData[prop.originalKey], prop.format) }}
                                </template>
                                <template v-else-if="prop.type === 'number' || prop.type === 'integer'">
                                     <span v-if="initiativeData[prop.originalKey] === null || initiativeData[prop.originalKey] === undefined" class="text-slate-500 italic">N/A</span>
                                     <span v-else>{{ initiativeData[prop.originalKey] }}</span>
                                </template>
                                <template v-else-if="initiativeData[prop.originalKey] !== null && initiativeData[prop.originalKey] !== undefined && initiativeData[prop.originalKey] !== ''">
                                    <div v-if="prop.format === 'textarea'" class="whitespace-pre-wrap">{{ initiativeData[prop.originalKey] }}</div>
                                    <span v-else>{{ initiativeData[prop.originalKey] }}</span>
                                </template>
                                <span v-else class="text-slate-500 italic">N/A</span>

                                <div v-if="prop['nn-tag']" class="mt-1">
                                    <span v-for="tag in (Array.isArray(prop['nn-tag']) ? prop['nn-tag'] : [prop['nn-tag']])" :key="tag"
                                          class="inline-block bg-sky-100 text-sky-700 text-xs font-medium mr-2 mb-1 px-2.5 py-0.5 rounded-full">
                                        {{ tag }}
                                    </span>
                                </div>
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>
            <div v-else class="text-center py-10 text-lg text-slate-500">Loading initiative details...</div>
        `
        };

        const InitiativeEditView = {
            setup() {
                const routeId = computed(() => appInstance ? appInstance.currentId : null);
                const isCreateMode = computed(() => routeId.value === 'new');

                const baseInitiativeSchema = computed(() => dataStore.getInitiativeSchema());
                const programConfig = computed(() => dataStore.getProgramData());

                const formSchemaForJsonForms = computed(() => {
                    if (!baseInitiativeSchema.value || !programConfig.value) return null;

                    const schemaCopy = JSON.parse(JSON.stringify(baseInitiativeSchema.value));

                    if (schemaCopy.properties.initiativePhase && programConfig.value.programStages) {
                        schemaCopy.properties.initiativePhase.enum = [...programConfig.value.programStages];
                    }
                    if (schemaCopy.properties.initiativeType && programConfig.value.programDefaultInitiativeTypes) {
                        schemaCopy.properties.initiativeType.enum = [...programConfig.value.programDefaultInitiativeTypes];
                    }

                    // Exclude auto-managed fields from appearing in the form
                    // These fields are typically set by the system or through specific actions, not direct user input on a generic form.
                    if (schemaCopy.properties.initiativeId) delete schemaCopy.properties.initiativeId;
                    if (schemaCopy.properties.initiativeLastUpdated) delete schemaCopy.properties.initiativeLastUpdated;
                    // initiativeDateRegistered is auto-set on creation, so not typically user-editable.
                    // If it needs to be on the form for creation (but not editable later), specific logic for that would be needed.
                    // For now, removing it from general form rendering is simpler.
                    if (schemaCopy.properties.initiativeDateRegistered && !isCreateMode.value) { // Only remove if not create mode
                         // Or, more simply, always remove if we decide it's purely system-managed after creation
                         // delete schemaCopy.properties.initiativeDateRegistered;
                    }


                    return schemaCopy;
                });

                const initialInitiativeData = computed(() => {
                    if (isCreateMode.value || !routeId.value || !dataStore.getInitiativesData()) return null;
                    return dataStore.getInitiativesData().find(i => i.initiativeId === routeId.value);
                });

                const formData = ref({});
                const pageTitle = computed(() => isCreateMode.value ? 'Create New Initiative' : `Edit ${formData.value.initiativeName || 'Initiative'}`);

                const initializeNewData = (schema, progConfig) => { // schema here is formSchemaForJsonForms
                    const newInit = {};
                    if (schema && schema.properties) {
                        for (const [key, propDefPair] of Object.entries(schema.properties)) {
                            const propDef = propDefPair as any;
                            if (key === 'initiativeId' || key === 'initiativeLastUpdated') continue;

                            if (propDef.default !== undefined) {
                                newInit[key] = propDef.default;
                            } else {
                                if (propDef.type === 'array') newInit[key] = [];
                                else if (propDef.type === 'boolean') newInit[key] = false;
                                else if (key === 'initiativePhase' && propDef.enum && propDef.enum.length > 0) {
                                     newInit[key] = propDef.enum[0]; // Default to first phase from dynamic enum
                                }
                                else if (key === 'initiativeType' && propDef.enum && propDef.enum.length > 0) {
                                     newInit[key] = propDef.enum[0]; // Default to first type from dynamic enum
                                }
                                else newInit[key] = '';
                            }
                        }
                    }
                    newInit['initiativeId'] = null;
                    newInit['initiativeDateRegistered'] = new Date().toISOString().split('T')[0];
                    newInit['initiativeLastUpdated'] = new Date().toISOString();
                    return newInit;
                };

                watch([initialInitiativeData, formSchemaForJsonForms, programConfig, isCreateMode],
                    ([currentData, formSchema, progConf, createMode]) => {
                    if (createMode && formSchema && progConf) {
                        formData.value = initializeNewData(formSchema, progConf);
                    } else if (currentData) {
                        formData.value = JSON.parse(JSON.stringify(currentData));
                    } else if (!createMode && !currentData && formSchema && progConf) {
                         formData.value = {}; // Edit mode but no data yet
                    }
                     else {
                        formData.value = {};
                    }
                }, { immediate: true, deep: true });

                const formHtml = computed(() => {
                    if (formSchemaForJsonForms.value && (Object.keys(formData.value).length > 0 || isCreateMode.value) ) {
                        return formRenderer.renderForm(formSchemaForJsonForms.value, formData.value, 'init_');
                    }
                    return '<p class="text-slate-500">Loading form or schema...</p>';
                });

                const handleFormInput = (event) => {
                    const target = event.target as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;
                    if (target && target.name) {
                        const { name, value } = target;
                        if ((target as HTMLInputElement).type === 'checkbox') {
                             formData.value[name] = (target as HTMLInputElement).checked;
                        } else {
                            formData.value[name] = value;
                        }
                    }
                };

                const saveInitiative = () => {
                    let isValid = true;
                    const schemaToValidate = baseInitiativeSchema.value;
                    if (schemaToValidate && schemaToValidate.required && Array.isArray(schemaToValidate.required)) {
                        for (const reqField of schemaToValidate.required) {
                             if (reqField === 'initiativeId' && isCreateMode.value) continue;
                             if (reqField === 'initiativeLastUpdated') continue;
                             if (reqField === 'initiativeDateRegistered' && isCreateMode.value && formData.value[reqField]) continue;


                            const fieldSchema = schemaToValidate.properties[reqField];
                            const title = fieldSchema?.title || reqField;
                            if (!formData.value[reqField] && !(typeof formData.value[reqField] === 'boolean' && formData.value[reqField] === false)) {
                                isValid = false;
                                alert(`Field '${title}' is required.`);
                                break;
                            }
                        }
                    }
                    if (!isValid) return;

                    const dataToSave = JSON.parse(JSON.stringify(formData.value));
                    let targetId = routeId.value;
                    dataToSave.initiativeLastUpdated = new Date().toISOString();

                    if (isCreateMode.value) {
                        dataToSave.initiativeId = 'init_' + Date.now().toString(36) + Math.random().toString(36).substring(2);
                        targetId = dataToSave.initiativeId;
                        if (!dataToSave.initiativeDateRegistered) {
                            dataToSave.initiativeDateRegistered = new Date().toISOString().split('T')[0];
                        }
                        console.log('Creating new initiative:', dataToSave);
                        if (dataStore.state.value.data && dataStore.state.value.data.initiatives) {
                            dataStore.state.value.data.initiatives.push(dataToSave);
                        } else if (dataStore.state.value.data) {
                             dataStore.state.value.data.initiatives = [dataToSave];
                        }
                    } else {
                        console.log('Updating initiative:', dataToSave);
                         if (dataStore.state.value.data && dataStore.state.value.data.initiatives) {
                            const index = dataStore.state.value.data.initiatives.findIndex(i => i.initiativeId === targetId);
                            if (index !== -1) {
                                dataStore.state.value.data.initiatives[index] = dataToSave;
                            } else {
                                console.error("Initiative not found in store for update");
                                alert("Error: Could not find initiative to update.");
                                return;
                            }
                        }
                    }
                    alert('Initiative saved (simulated)!');
                    if (appInstance && targetId) appInstance.navigateTo('InitiativeDetail', { id: targetId });
                };

                const cancelEdit = () => {
                     if (isCreateMode.value) {
                        if (appInstance) appInstance.navigateTo('InitiativeLifecycle');
                    } else {
                        if (appInstance && routeId.value) appInstance.navigateTo('InitiativeDetail', { id: routeId.value });
                    }
                };
                const backNavigation = () => cancelEdit();

                return {
                    formData, formHtml, handleFormInput, saveInitiative, cancelEdit, pageTitle,
                    isCreateMode, formSchemaForJsonForms,
                    backNavigation, programConfig, dataStore // for v-if checks
                };
            },
            template: `
            <div class="bg-white shadow-md rounded-lg p-6">
                <div class="mb-6">
                    <button @click="backNavigation" class="text-sm text-sky-600 hover:underline">&larr; {{ isCreateMode ? 'Back to Initiatives List' : 'Back to Details' }}</button>
                </div>
                <h2 class="text-2xl font-semibold text-slate-700 mb-6">{{ pageTitle }}</h2>
                <div v-if="!formSchemaForJsonForms || (isCreateMode && !programConfig) || (Object.keys(formData).length === 0 && !dataStore.isLoading() && !isCreateMode)"
                     class="text-center py-10 text-slate-500">
                     <span v-if="dataStore.isLoading()">Loading data...</span>
                     <span v-else-if="!formSchemaForJsonForms || (isCreateMode && !programConfig)">Loading schema or program configuration...</span>
                     <span v-else-if="Object.keys(formData).length === 0 && !isCreateMode">Initiative data not found or could not be loaded.</span>
                     <span v-else-if="Object.keys(formData).length === 0 && isCreateMode">Initializing form...</span>
                </div>
                <form v-else @input.capture="handleFormInput">
                    <div v-html="formHtml"></div>
                    <div class="mt-8 flex justify-end space-x-3">
                        <button @click.prevent="cancelEdit" type="button" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-4 rounded-md text-sm">Cancel</button>
                        <button @click.prevent="saveInitiative" type="button" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md text-sm">Save Initiative</button>
                    </div>
                </form>
            </div>
        `
        };

        const App = {
            components: {
                'program-configuration-view': ProgramConfigurationView,
                'people-list-view': PeopleListView,
                'person-detail-view': PersonDetailView,
                'person-edit-view': PersonEditView,
                'opportunities-list-view': OpportunitiesListView,
                'opportunity-detail-view': OpportunityDetailView,
                'opportunity-edit-view': OpportunityEditView,
                'initiatives-list-view': InitiativesListView,
                'initiative-detail-view': InitiativeDetailView,
                'initiative-edit-view': InitiativeEditView
            },
            setup() {
                const currentView = ref(null);
                const currentId = ref(null);
                const loading = computed(() => dataStore.state.value.loading);
                const error = computed(() => dataStore.state.value.error);

                const getViewAndIdFromHash = () => {
                    const hash = window.location.hash.replace(/^#\/?|\/$/g, '');
                    const parts = hash.split('/');
                    return {
                        view: parts[0] || null,
                        id: parts[1] || null
                    };
                };

                const navigateTo = (viewName, params = null) => {
                    let hash = viewName;
                    if (params && params.id) {
                        hash += '/' + params.id;
                    }
                    window.location.hash = hash; // This will trigger handleHashChange
                };

                const handleHashChange = () => {
                    const { view: viewNameFromHash, id: idFromHash } = getViewAndIdFromHash();

                    const knownBaseViews = ['ProgramConfiguration', 'PeopleManagement', 'OpportunitiesDiscovery', 'InitiativeLifecycle',
                                          'PersonDetail', 'PersonEdit', 'OpportunityDetail', 'OpportunityEdit',
                                          'InitiativeDetail', 'InitiativeEdit'];

                    if (viewNameFromHash && knownBaseViews.includes(viewNameFromHash)) {
                        currentView.value = viewNameFromHash;
                        currentId.value = idFromHash;
                    } else if (!viewNameFromHash && !loading.value && !error.value) {
                        navigateTo('ProgramConfiguration'); // Default view
                    } else if (viewNameFromHash) {
                         console.warn(`Unknown view in hash: ${viewNameFromHash}. Redirecting to default.`);
                         navigateTo('ProgramConfiguration');
                    }
                };

                const navButtonClasses = (viewName) => {
                    const baseCurrentView = currentView.value ? currentView.value.split('/')[0] : null;
                    return {
                        'bg-slate-900 text-white': baseCurrentView === viewName,
                    };
                };

                onMounted(async () => {
                    appInstance = getCurrentInstance().proxy;
                    await dataStore.loadData();
                    window.addEventListener('hashchange', handleHashChange);

                    const { view: initialViewFromHash, id: initialIdFromHash } = getViewAndIdFromHash();
                    if (initialViewFromHash && !dataStore.state.value.error) {
                        const knownBaseViews = ['ProgramConfiguration', 'PeopleManagement', 'OpportunitiesDiscovery', 'InitiativeLifecycle',
                                              'PersonDetail', 'PersonEdit', 'OpportunityDetail', 'OpportunityEdit',
                                              'InitiativeDetail', 'InitiativeEdit'];
                        if (knownBaseViews.includes(initialViewFromHash)) {
                            currentView.value = initialViewFromHash;
                            currentId.value = initialIdFromHash;
                        } else {
                            navigateTo('ProgramConfiguration');
                        }
                    } else if (!dataStore.state.value.error) {
                        navigateTo('ProgramConfiguration');
                    }
                });

                return {
                    currentView,
                    currentId, // Expose currentId
                    loading,
                    error,
                    navButtonClasses,
                    navigateTo
                };
            },
            template: `
<div class="min-h-screen bg-slate-100 text-slate-800">
    <!-- Header -->
    <header class="bg-slate-800 text-white shadow-md">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center">
                <!-- Placeholder for an SVG Icon (e.g., Heroicon Cube) -->
                <div class="h-8 w-8 mr-3 bg-sky-400 rounded flex items-center justify-center text-white font-bold">iN</div>
                <span class="text-xl font-bold tracking-tight">iNNitiatives (CDN)</span>
            </div>
            <div class="flex space-x-2">
                <!-- Placeholder buttons, functionality to be added later -->
                <button class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-3 rounded-md text-sm">File</button>
                <button class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-3 rounded-md text-sm">Export</button>
            </div>
        </div>
    </header>

    <!-- Main Navigation -->
    <nav class="bg-slate-700 shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex space-x-1">
                <!-- Navigation Links - functionality to be added later using view swapping -->
                <button @click="navigateTo('ProgramConfiguration')" :class="navButtonClasses('ProgramConfiguration')" class="text-slate-300 hover:bg-slate-900 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Program</button>
                <button @click="navigateTo('PeopleManagement')" :class="navButtonClasses('PeopleManagement')" class="text-slate-300 hover:bg-slate-900 hover:text-white px-3 py-2 rounded-md text-sm font-medium">People</button>
                <button @click="navigateTo('OpportunitiesDiscovery')" :class="navButtonClasses('OpportunitiesDiscovery')" class="text-slate-300 hover:bg-slate-900 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Opportunities</button>
                <button @click="navigateTo('InitiativeLifecycle')" :class="navButtonClasses('InitiativeLifecycle')" class="text-slate-300 hover:bg-slate-900 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Initiatives</button>
            </div>
        </div>
    </nav>

    <!-- Content Area -->
    <main class="container mx-auto p-4">
        <div v-if="loading" class="text-center py-10 text-lg text-slate-500">Loading application data...</div>
        <div v-else-if="error" class="text-center py-10 text-lg text-red-600">Error loading data: {{ error }}</div>
        <div v-else>
            <!-- View content will be rendered here based on currentView -->
                    <program-configuration-view v-if="currentView === 'ProgramConfiguration'"></program-configuration-view>
                    <people-list-view v-if="currentView === 'PeopleManagement'"></people-list-view>
                    <person-detail-view v-if="currentView === 'PersonDetail'"></person-detail-view>
                    <person-edit-view v-if="currentView === 'PersonEdit'"></person-edit-view>
                    <opportunities-list-view v-if="currentView === 'OpportunitiesDiscovery'"></opportunities-list-view>
                    <opportunity-detail-view v-if="currentView === 'OpportunityDetail'"></opportunity-detail-view>
                    <opportunity-edit-view v-if="currentView === 'OpportunityEdit'"></opportunity-edit-view>
                    <initiatives-list-view v-if="currentView === 'InitiativeLifecycle'"></initiatives-list-view>
                    <initiative-detail-view v-if="currentView === 'InitiativeDetail'"></initiative-detail-view>
                    <initiative-edit-view v-if="currentView === 'InitiativeEdit'"></initiative-edit-view>
            <!-- Default message if no view is selected or data not ready -->
            <div v-if="!currentView && !loading && !error">Please select a section.</div>
        </div>
    </main>
</div>
            `
        };

        createApp(App).mount('#app');
    </script>
</body>
</html>
